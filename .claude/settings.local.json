{
  "permissions": {
    "allow": [
      "Bash(git push origin main)",
      "Bash(git checkout src/agents/facebook_agent.py)",
      "Bash(git add Macspark/marketing-automation/api/src/utils/token_manager.py Macspark/marketing-automation/api/src/utils/database.py)",
      "Bash(git commit -m \"$(cat <<''EOF''\nrefactor(p1-7): migrar exce√ß√µes cr√≠ticas em token_manager e database\n\nImplementa migra√ß√£o parcial Phase 1 do P1 #7.\nRefatora exce√ß√µes gen√©ricas para customizadas em 2 arquivos cr√≠ticos.\n\n## Arquivos Migrados (2/4 Phase 1)\n\n### 1. src/utils/token_manager.py\n**Mudan√ßas**:\n- Adicionado import: InvalidTokenError, FacebookConnectionError\n- Linha 43: `raise Exception(\"Token inv√°lido\")` \n  ‚Üí `raise InvalidTokenError(message=..., details={...})`\n- Agora retorna erro estruturado com token_expiry nos details\n\n**Impacto**: \n- Melhores mensagens de erro de autentica√ß√£o\n- Error code espec√≠fico: INVALID_TOKEN\n- Contexto adicional para debugging\n\n### 2. src/utils/database.py\n**Mudan√ßas**:\n- Adicionado import: DatabaseQueryError, logger\n- Linha 42: `except Exception:` ‚Üí adiciona log antes de rollback\n- Mant√©m re-raise mas com log estruturado\n\n**Impacto**:\n- Melhor rastreamento de erros de database\n- Logs estruturados para debugging\n- Preparado para usar DatabaseQueryError futuramente\n\n## Status P1 #7\n\n**Progresso**: 2/4 arquivos Phase 1 (50%)\n**Migrado**: 2 exce√ß√µes gen√©ricas ‚Üí customizadas\n**Pendente**: \n- auth.py (1 exce√ß√£o - √© safety fallback v√°lido)\n- facebook_agent.py (3 exce√ß√µes - pr√≥ximo)\n\n## Benef√≠cios Imediatos\n\n1. **Token errors** agora retornam:\n```json\n{\n  \"error\": \"INVALID_TOKEN\",\n  \"message\": \"Token validation failed - token is invalid or expired\",\n  \"details\": {\"token_expiry\": \"2025-10-20T12:00:00\"}\n}\n```\n\n2. **Database errors** agora tem logs estruturados antes de rollback\n\n## Pr√≥ximos Passos\n\n- [ ] Migrar facebook_agent.py (3 exce√ß√µes)\n- [ ] Migrar outros 58 handlers (Phase 2-4)\n\nü§ñ Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(git add Macspark/marketing-automation/.claude/settings.local.json)",
      "Bash(git commit -m \"chore(marketing-automation): atualizar configura√ß√µes locais Claude\n\nAtualiza√ß√£o de settings locais do Claude Code para o projeto.\n\nü§ñ Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\")",
      "Bash(git push origin main --dry-run)",
      "Bash(git push -u origin main)",
      "Bash(cat \"c:\\Users\\marco\\Macspark\\marketing-automation\\README.md\")",
      "Bash(tree -L 2 \"c:\\Users\\marco\\Macspark\\marketing-automation\\api\\src\" -I \"__pycache__\")"
    ],
    "deny": [],
    "ask": []
  }
}
