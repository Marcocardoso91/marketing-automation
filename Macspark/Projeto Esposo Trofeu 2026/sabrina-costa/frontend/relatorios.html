<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rios Semanais | Dashboard Sabrina</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        .report-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .report-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 35px -20px rgba(59, 130, 246, 0.3);
        }
    </style>
</head>
<body class="bg-gray-50" x-data="reportsApp()" x-init="init()">

    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <span class="ml-2 text-xl font-bold text-gray-900">Dashboard Sabrina</span>
                    </div>

                    <div class="hidden md:ml-10 md:flex md:space-x-4">
                        <a href="dashboard.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">
                            Dashboard
                        </a>
                        <a href="cronograma.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">
                            Cronograma
                        </a>
                        <a href="ganchos.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">
                            Ganchos
                        </a>
                        <a href="checklist.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">
                            Checklist
                        </a>
                        <a href="relatorios.html" class="px-3 py-2 rounded-md text-sm font-medium bg-purple-50 text-purple-700">
                            Relat√≥rios
                        </a>
                        <a href="configuracoes.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">
                            Configura√ß√µes
                        </a>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <button @click="exportPDF()"
                            class="inline-flex items-center px-3 py-2 border border-gray-200 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50 transition">
                        üìÑ Exportar PDF
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <header class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-8">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Relat√≥rios Semanais</h1>
                <p class="text-sm text-gray-600 mt-1">
                    Vis√£o consolidada de desempenho, aprendizados e pr√≥ximos passos para a presen√ßa digital da Sabrina.
                </p>
            </div>

            <div class="flex flex-wrap gap-3">
                <select x-model="selectedWeek" @change="changeWeek"
                        class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500">
                    <template x-for="report in reports" :key="report.id">
                        <option :value="report.id" x-text="report.label"></option>
                    </template>
                </select>
                <button @click="sendSummary()"
                        class="inline-flex items-center px-3 py-2 border border-purple-200 rounded-lg text-sm font-medium text-purple-700 hover:bg-purple-50 transition">
                    ‚úâÔ∏è Enviar resumo
                </button>
            </div>
        </header>

        <!-- KPI Cards -->
        <section class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
            <div class="report-card bg-white rounded-2xl border border-gray-200 shadow-sm p-6">
                <p class="text-xs font-semibold uppercase text-gray-500">M√©dia CTR</p>
                <p class="text-3xl font-bold text-gray-900 mt-2" x-text="currentReport.kpis.ctr + '%'"></p>
                <p class="text-sm mt-3" :class="trendClass(currentReport.trends.ctr)">
                    <span x-text="currentReport.trends.ctr > 0 ? '+' + currentReport.trends.ctr : currentReport.trends.ctr"></span> vs semana anterior
                </p>
            </div>

            <div class="report-card bg-white rounded-2xl border border-gray-200 shadow-sm p-6">
                <p class="text-xs font-semibold uppercase text-gray-500">Novos seguidores</p>
                <p class="text-3xl font-bold text-gray-900 mt-2" x-text="currentReport.kpis.newFollowers"></p>
                <p class="text-sm mt-3" :class="trendClass(currentReport.trends.newFollowers)">
                    <span x-text="formatTrend(currentReport.trends.newFollowers)"></span>
                </p>
            </div>

            <div class="report-card bg-white rounded-2xl border border-gray-200 shadow-sm p-6">
                <p class="text-xs font-semibold uppercase text-gray-500">Investimento</p>
                <p class="text-3xl font-bold text-gray-900 mt-2" x-text="'R$ ' + currentReport.kpis.cost"></p>
                <p class="text-sm mt-3" :class="trendClass(-currentReport.trends.cost)">
                    <span x-text="formatTrend(-currentReport.trends.cost)"></span> custo por seguidor
                </p>
            </div>

            <div class="report-card bg-white rounded-2xl border border-gray-200 shadow-sm p-6">
                <p class="text-xs font-semibold uppercase text-gray-500">Alertas cr√≠ticos</p>
                <p class="text-3xl font-bold text-gray-900 mt-2" x-text="currentReport.alerts.critical"></p>
                <p class="text-sm mt-3 text-gray-500">
                    <span x-text="currentReport.alerts.description"></span>
                </p>
            </div>
        </section>

        <!-- Charts -->
        <section class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8">
            <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6 xl:col-span-2">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">Desempenho di√°rio</h2>
                    <p class="text-xs text-gray-400">CTR, seguidores e investimento por dia</p>
                </div>
                <canvas id="performanceChart" height="120"></canvas>
            </div>

            <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6 flex flex-col">
                <h2 class="text-lg font-semibold text-gray-900 mb-3">Top insights</h2>
                <ul class="space-y-3 flex-1">
                    <template x-for="insight in currentReport.insights" :key="insight">
                        <li class="text-sm text-gray-700 bg-gray-50 border border-gray-200 rounded-xl px-4 py-3">
                            <span class="text-purple-500 mr-2">‚Ä¢</span>
                            <span x-text="insight"></span>
                        </li>
                    </template>
                </ul>
            </div>
        </section>

        <!-- Table -->
        <section class="bg-white border border-gray-200 rounded-2xl shadow-sm">
            <header class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                <div>
                    <h2 class="text-lg font-semibold text-gray-900">Resumo por conte√∫do</h2>
                    <p class="text-sm text-gray-500">Resultados dos posts que foram ao ar na semana selecionada.</p>
                </div>
                <button @click="copyTable()"
                        class="inline-flex items-center px-3 py-2 border border-gray-200 rounded-lg text-sm text-gray-600 hover:bg-gray-50 transition">
                    üìã Copiar tabela
                </button>
            </header>

            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 text-sm">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider">Data</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider">Formato</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider">Tema</th>
                            <th class="px-6 py-3 text-right font-medium text-gray-500 uppercase tracking-wider">CTR</th>
                            <th class="px-6 py-3 text-right font-medium text-gray-500 uppercase tracking-wider">Seguidores</th>
                            <th class="px-6 py-3 text-right font-medium text-gray-500 uppercase tracking-wider">Salvamentos</th>
                            <th class="px-6 py-3 text-right font-medium text-gray-500 uppercase tracking-wider">Investimento</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-100">
                        <template x-for="item in currentReport.posts" :key="item.id">
                            <tr class="hover:bg-purple-50/50">
                                <td class="px-6 py-4 whitespace-nowrap text-gray-700" x-text="formatDate(item.date)"></td>
                                <td class="px-6 py-4 whitespace-nowrap text-gray-700" x-text="item.format"></td>
                                <td class="px-6 py-4 text-gray-900 font-medium" x-text="item.theme"></td>
                                <td class="px-6 py-4 text-right text-gray-700" x-text="item.ctr + '%'"></td>
                                <td class="px-6 py-4 text-right text-gray-700" x-text="item.newFollowers"></td>
                                <td class="px-6 py-4 text-right text-gray-700" x-text="item.saves"></td>
                                <td class="px-6 py-4 text-right text-gray-700" x-text="'R$ ' + item.cost"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <script src="assets/js/api.js"></script>
    <script>
        function reportsApp() {
            return {
                reports: [],
                selectedWeek: null,
                currentReport: {},
                performanceChart: null,

                async init() {
                    await this.loadReports();
                    this.selectedWeek = this.reports[0]?.id;
                    this.changeWeek();
                },

                async loadReports() {
                    // Mocked weekly reports
                    this.reports = [
                        {
                            id: 'week-4',
                            label: 'Semana 4 ‚Ä¢ 13 a 19 jan',
                            kpis: { ctr: 6.1, newFollowers: 198, cost: 560 },
                            trends: { ctr: 0.8, newFollowers: 12, cost: -5 },
                            alerts: { critical: 1, description: '1 alerta de CTR baixo (quinta-feira)' },
                            insights: [
                                'Reels com comparativos geraram +32% de salvamentos.',
                                'WhatsApp trouxe 14 leads qualificados via lembrete autom√°tico.',
                                'CTA ‚Äúcomenta EU‚Äù performou melhor que ‚Äúcompartilha‚Äù (+21% engajamento).',
                            ],
                            posts: [
                                { id: 1, date: '2025-01-13', format: 'Reels', theme: 'Transforma√ß√£o real', ctr: 6.8, newFollowers: 58, saves: 140, cost: 160 },
                                { id: 2, date: '2025-01-15', format: 'Carrossel', theme: 'Checklist pr√°tica', ctr: 5.9, newFollowers: 46, saves: 120, cost: 130 },
                                { id: 3, date: '2025-01-17', format: 'Reels', theme: 'Erro comum e corre√ß√£o', ctr: 6.3, newFollowers: 52, saves: 110, cost: 140 },
                                { id: 4, date: '2025-01-19', format: 'Stories s√©rie', theme: 'Bastidores + CTA', ctr: 5.4, newFollowers: 42, saves: 75, cost: 130 },
                            ],
                            daily: [
                                { date: '13', ctr: 6.8, newFollowers: 58, cost: 140 },
                                { date: '14', ctr: 6.0, newFollowers: 45, cost: 120 },
                                { date: '15', ctr: 5.9, newFollowers: 46, cost: 130 },
                                { date: '16', ctr: 6.4, newFollowers: 49, cost: 140 },
                                { date: '17', ctr: 6.3, newFollowers: 52, cost: 140 },
                                { date: '18', ctr: 5.6, newFollowers: 40, cost: 120 },
                                { date: '19', ctr: 5.4, newFollowers: 42, cost: 130 },
                            ],
                        },
                        {
                            id: 'week-3',
                            label: 'Semana 3 ‚Ä¢ 6 a 12 jan',
                            kpis: { ctr: 5.5, newFollowers: 186, cost: 580 },
                            trends: { ctr: 0.2, newFollowers: -8, cost: 3 },
                            alerts: { critical: 2, description: '2 alertas (CPC alto no s√°bado, CTR baixo domingo)' },
                            insights: [
                                'Posts com CTA ‚Äúenvia para uma amiga‚Äù performaram abaixo do esperado.',
                                'Stories com enquetes geraram 12 perguntas que viraram conte√∫do.',
                                'WhatsApp respondeu por 18% das convers√µes com gatilho de urg√™ncia.',
                            ],
                            posts: [
                                { id: 11, date: '2025-01-06', format: 'Reels', theme: 'Dia na vida', ctr: 5.4, newFollowers: 45, saves: 95, cost: 140 },
                                { id: 12, date: '2025-01-08', format: 'Carrossel', theme: 'Checklist consultoria', ctr: 5.6, newFollowers: 48, saves: 100, cost: 145 },
                                { id: 13, date: '2025-01-10', format: 'Live recorte', theme: 'Perguntas frequentes', ctr: 5.5, newFollowers: 52, saves: 105, cost: 150 },
                                { id: 14, date: '2025-01-12', format: 'Stories', theme: 'Prova social', ctr: 5.3, newFollowers: 41, saves: 70, cost: 145 },
                            ],
                            daily: [
                                { date: '06', ctr: 5.4, newFollowers: 45, cost: 140 },
                                { date: '07', ctr: 5.6, newFollowers: 40, cost: 120 },
                                { date: '08', ctr: 5.6, newFollowers: 48, cost: 145 },
                                { date: '09', ctr: 5.7, newFollowers: 50, cost: 150 },
                                { date: '10', ctr: 5.5, newFollowers: 52, cost: 150 },
                                { date: '11', ctr: 5.3, newFollowers: 40, cost: 120 },
                                { date: '12', ctr: 5.3, newFollowers: 41, cost: 145 },
                            ],
                        },
                    ];

                    // Produ√ß√£o: const response = await API.metrics.summary({ period: '7d', week: 4 });
                },

                changeWeek() {
                    this.currentReport = this.reports.find((report) => report.id === this.selectedWeek) || this.reports[0];
                    this.$nextTick(() => this.renderChart());
                },

                renderChart() {
                    const ctx = document.getElementById('performanceChart').getContext('2d');
                    if (this.performanceChart) {
                        this.performanceChart.destroy();
                    }

                    const labels = this.currentReport.daily.map((item) => item.date);

                    this.performanceChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels,
                            datasets: [
                                {
                                    label: 'CTR (%)',
                                    data: this.currentReport.daily.map((item) => item.ctr),
                                    borderColor: 'rgb(147, 51, 234)',
                                    backgroundColor: 'rgba(147, 51, 234, 0.1)',
                                    tension: 0.4,
                                    fill: true,
                                    yAxisID: 'y',
                                },
                                {
                                    label: 'Novos seguidores',
                                    data: this.currentReport.daily.map((item) => item.newFollowers),
                                    borderColor: 'rgb(14, 165, 233)',
                                    backgroundColor: 'rgba(14, 165, 233, 0.1)',
                                    tension: 0.4,
                                    fill: true,
                                    yAxisID: 'y1',
                                },
                                {
                                    label: 'Investimento (R$)',
                                    data: this.currentReport.daily.map((item) => item.cost),
                                    borderColor: 'rgb(34, 197, 94)',
                                    backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                    borderDash: [4, 4],
                                    tension: 0.4,
                                    fill: false,
                                    yAxisID: 'y2',
                                },
                            ],
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: { mode: 'index', intersect: false },
                            plugins: { legend: { display: true, position: 'top' } },
                            scales: {
                                y: { type: 'linear', position: 'left', beginAtZero: true },
                                y1: { type: 'linear', position: 'right', beginAtZero: true, grid: { drawOnChartArea: false } },
                                y2: { type: 'linear', position: 'right', beginAtZero: true, grid: { drawOnChartArea: false }, display: false },
                            },
                        },
                    });
                },

                trendClass(value) {
                    if (value > 0) return 'text-emerald-600';
                    if (value < 0) return 'text-rose-500';
                    return 'text-gray-500';
                },

                formatTrend(value) {
                    const prefix = value > 0 ? '+' : '';
                    return `${prefix}${value}%`;
                },

                formatDate(date) {
                    const [year, month, day] = date.split('-');
                    return `${day}/${month}`;
                },

                exportPDF() {
                    alert('Exporta√ß√£o em PDF dispon√≠vel na vers√£o completa (integra√ß√£o com servi√ßo de render).');
                },

                sendSummary() {
                    alert('Resumo enviado para o cliente via e-mail (simula√ß√£o).');
                },

                copyTable() {
                    const text = this.currentReport.posts.map((row) => (
                        `${this.formatDate(row.date)} | ${row.format} | ${row.theme} | ${row.ctr}% | ${row.newFollowers} seguidores | ${row.saves} salvamentos | R$ ${row.cost}`
                    )).join('\n');

                    navigator.clipboard.writeText(text).then(() => {
                        alert('Tabela copiada para a √°rea de transfer√™ncia!');
                    });
                },
            }
        }
    </script>
</body>
</html>
