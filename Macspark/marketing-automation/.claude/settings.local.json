{
  "permissions": {
    "allow": [
      "Bash(git push origin main)",
      "Bash(git checkout src/agents/facebook_agent.py)",
      "Bash(git add Macspark/marketing-automation/api/src/utils/token_manager.py Macspark/marketing-automation/api/src/utils/database.py)",
      "Bash(git commit -m \"$(cat <<''EOF''\nrefactor(p1-7): migrar exceÃ§Ãµes crÃ­ticas em token_manager e database\n\nImplementa migraÃ§Ã£o parcial Phase 1 do P1 #7.\nRefatora exceÃ§Ãµes genÃ©ricas para customizadas em 2 arquivos crÃ­ticos.\n\n## Arquivos Migrados (2/4 Phase 1)\n\n### 1. src/utils/token_manager.py\n**MudanÃ§as**:\n- Adicionado import: InvalidTokenError, FacebookConnectionError\n- Linha 43: `raise Exception(\"Token invÃ¡lido\")` \n  â†’ `raise InvalidTokenError(message=..., details={...})`\n- Agora retorna erro estruturado com token_expiry nos details\n\n**Impacto**: \n- Melhores mensagens de erro de autenticaÃ§Ã£o\n- Error code especÃ­fico: INVALID_TOKEN\n- Contexto adicional para debugging\n\n### 2. src/utils/database.py\n**MudanÃ§as**:\n- Adicionado import: DatabaseQueryError, logger\n- Linha 42: `except Exception:` â†’ adiciona log antes de rollback\n- MantÃ©m re-raise mas com log estruturado\n\n**Impacto**:\n- Melhor rastreamento de erros de database\n- Logs estruturados para debugging\n- Preparado para usar DatabaseQueryError futuramente\n\n## Status P1 #7\n\n**Progresso**: 2/4 arquivos Phase 1 (50%)\n**Migrado**: 2 exceÃ§Ãµes genÃ©ricas â†’ customizadas\n**Pendente**: \n- auth.py (1 exceÃ§Ã£o - Ã© safety fallback vÃ¡lido)\n- facebook_agent.py (3 exceÃ§Ãµes - prÃ³ximo)\n\n## BenefÃ­cios Imediatos\n\n1. **Token errors** agora retornam:\n```json\n{\n  \"error\": \"INVALID_TOKEN\",\n  \"message\": \"Token validation failed - token is invalid or expired\",\n  \"details\": {\"token_expiry\": \"2025-10-20T12:00:00\"}\n}\n```\n\n2. **Database errors** agora tem logs estruturados antes de rollback\n\n## PrÃ³ximos Passos\n\n- [ ] Migrar facebook_agent.py (3 exceÃ§Ãµes)\n- [ ] Migrar outros 58 handlers (Phase 2-4)\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(git add Macspark/marketing-automation/.claude/settings.local.json)"
    ],
    "deny": [],
    "ask": []
  }
}
